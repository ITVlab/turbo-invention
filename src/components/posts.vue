<style>

</style>

<template>

	<transition name="slide-fade">

		<div class="rt-main" v-if="loaded === 'true'" >


			<div class="column is-6" v-for="post in posts" :key="post.slug">

				<div class="box">

					<h2 class="rt-post-title title"><router-link :to="{ name: 'post', params: { name:post.slug }}"> {{ post.title.rendered }} </router-link> </h2>

					<div class="progressive">

						<img class="preview thumbnail" v-progressive="post.featured_image_src['full'][0]" :data-srcset="post.featured_image_src['srcset']" :src="post.featured_image_src['full'][0]" />
						
					</div>
					<div class="rt-meta">
						<span class="posted-on">
							Posted On
							<span class="date" v-text="formatDate( post )">
							</span>
						</span>
					</div>

					<div class="rt-post-excerpt rt-content" v-html="post.excerpt.rendered" > </div>

				</div>

			</div>

			<div class="medium-12 small-12 column rt-pagination">
				<a href=""  v-if="showPrev" v-on:click.prevent="rtShowPrev()"> &LT; prev  </a>
				<a > {{ currentPage }} / {{ totalPages }} </a>
				<a href=""  v-if="showNext" v-on:click.prevent="rtShowNext()"> more &GT; </a>
			</div>
		</div>

	</transition>

</template>

<script>
export default {

    	mounted: function() {

    		var vm = this;

			if ( vm.$route.params.page ) {

				vm.getPosts( vm.$route.params.page );

			} else {

				vm.getPosts();
			}

        },

        data() {

        	return {

                posts:{},
                currentPage: '',
                prevPage: '',
                nextPage: '',
                showNext:'true',
                showPrev:'true',
                postCollection:'',
                postPerPage: '10',
                totalPages: '',
                loaded:'false',
				pageTitle:''

            }

        },

        methods: {

            getPosts:function(pageNumber=1) {

            	var vm = this;
				vm.loaded = 'false';
				vm.$http.get( 'wp/v2/posts',{
					params:{  per_page: vm.postPerPage,page:pageNumber }
				} )
				.then( (res) => {
					console.log( res );
					vm.posts = res.data;
					vm.totalPages = res.headers['x-wp-totalpages'];

					if ( pageNumber <= parseInt( vm.totalPages ) ) {

						vm.currentPage = parseInt( pageNumber );

					} else {

						vm.$router.push({'name':'home'});
						vm.currentPage = 1;

					}

					vm.loaded = 'true';
					vm.pageTitle = 'Blog';
					vm.$store.commit( 'rtChangeTitle', vm.pageTitle );

				})
				.catch( (res) => {

					console( `Something wen wrong : ${res}` );
				})

            },
            rtShowNext:function( event ) {

                var vm = this;

                if( vm.currentPage < vm.totalPages ) {

                	vm.currentPage = vm.currentPage + 1;

					vm.$router.push({'name':'home', params:{ 'page': vm.currentPage } });
				}
            },
            rtShowPrev:function( event ) {

                var vm = this;
                if ( vm.currentPage != 1 ) {

                	vm.currentPage = vm.currentPage - 1;

					vm.$router.push({'name':'home', params:{ 'page': vm.currentPage } });

				}
            },
            formatDate:function ( value ) {
				value = value.date;
                if (value) {
                    var date  = new Date( value );
                    var monthNames = ["January", "February", "March",
                    "April", "May", "June", "July",
                    "August", "September", "October",
                    "November", "December"
                    ];

                    var day = date.getDate();
                    var monthIndex = date.getMonth();
                    var year = date.getFullYear();

                    return monthNames[monthIndex] + ',' + day + ' ' + year;
                }

		    }

		},
		watch: {

			'$route' (to, from) {
				this.getPosts( this.$route.params.page );
			}

		}
    }
</script>